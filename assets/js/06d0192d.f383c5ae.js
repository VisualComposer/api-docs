"use strict";(self.webpackChunktest_docs=self.webpackChunktest_docs||[]).push([[792],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>u});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(a),d=r,u=m["".concat(s,".").concat(d)]||m[d]||g[d]||o;return a?n.createElement(u,i(i({ref:t},c),{},{components:a})):n.createElement(u,i({ref:t},c))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},1604:(e,t,a)=>{a.r(t),a.d(t,{contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var n=a(7462),r=(a(7294),a(3905));const o={},i="Stores",l={unversionedId:"public-api/stores",id:"public-api/stores",isDocsHomePage:!1,title:"Stores",description:"Stores are connectors between different parts of the editor. You can use a publish-subscribe pattern with the help of trigger, on, once methods of the storage. You can also save state and subscribe to state onChange method.",source:"@site/docs/public-api/stores.md",sourceDirName:"public-api",slug:"/public-api/stores",permalink:"/public-api/stores",editUrl:"https://github.com/VisualComposer/api-docs/edit/main/docs/public-api/stores.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Services",permalink:"/public-api/services"},next:{title:"API Setup",permalink:"/editor-api/api-setup"}},s=[{value:"vcCake library",id:"vccake-library",children:[]},{value:"Usage",id:"usage",children:[{value:"Get existing store",id:"get-existing-store",children:[]},{value:"Storage actions",id:"storage-actions",children:[]},{value:"Real life example",id:"real-life-example",children:[]}]},{value:"Stores list",id:"stores-list",children:[]}],p={toc:s},c="wrapper";function m(e){let{components:t,...a}=e;return(0,r.kt)(c,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"stores"},"Stores"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Stores")," are connectors between different parts of the editor. You can use a publish-subscribe pattern with the help of ",(0,r.kt)("inlineCode",{parentName:"p"},"trigger"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"on"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," methods of the storage. You can also save state and subscribe to state ",(0,r.kt)("inlineCode",{parentName:"p"},"onChange")," method."),(0,r.kt)("p",null,"With the help of vcCake library you can utilize multiple ",(0,r.kt)("strong",{parentName:"p"},"stores")," that help storing states and trigger events."),(0,r.kt)("h2",{id:"vccake-library"},"vcCake library"),(0,r.kt)("p",null,"Visual Composer uses a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/wpbakery/vc-cake"},"vcCake")," library which"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"allows to communicate modules with each other or even group objects in one scope without tight coupling.")),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("h3",{id:"get-existing-store"},"Get existing store"),(0,r.kt)("p",null,"To get existing storage ",(0,r.kt)("inlineCode",{parentName:"p"},"vc-cake")," library must be imported at the top of the file. Call ",(0,r.kt)("inlineCode",{parentName:"p"},"getStorage")," method with an argument of storage name (storage name is can be found in ",(0,r.kt)("inlineCode",{parentName:"p"},"addStorage")," method). Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { getStorage } from 'vc-cake'\nconst exampleStorage = getStorage('example')\n")),(0,r.kt)("h3",{id:"storage-actions"},"Storage actions"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Action"),(0,r.kt)("th",{parentName:"tr",align:null},"Arguments (type)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"on")),(0,r.kt)("td",{parentName:"tr",align:null},"event (string), callback (function), options (object -> { debounce: 1000 } \u2013 optional)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"once")),(0,r.kt)("td",{parentName:"tr",align:null},"event (string), callback (function)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"off")),(0,r.kt)("td",{parentName:"tr",align:null},"event (string), callback (function), options (object -> { debounce: 1000 } \u2013 optional)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"offOnce")),(0,r.kt)("td",{parentName:"tr",align:null},"event (string), callback (function)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"trigger")),(0,r.kt)("td",{parentName:"tr",align:null},"event (string), any value to pass in the listener callback")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"registerAction")),(0,r.kt)("td",{parentName:"tr",align:null},"action name (string), callback (function)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"action")),(0,r.kt)("td",{parentName:"tr",align:null},"action name (string)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"state")),(0,r.kt)("td",{parentName:"tr",align:null},"state name (string)")))),(0,r.kt)("h4",{id:"on-once"},"on, once"),(0,r.kt)("p",null,"These are listeners for events which are triggered. For example, listening for event \u2013 ",(0,r.kt)("inlineCode",{parentName:"p"},"elementAdd"),", once ",(0,r.kt)("inlineCode",{parentName:"p"},"elementAdd")," event will be triggered from any place, callback in this listener will be called."),(0,r.kt)("p",null,"On \u2013 will be triggered every time the event is triggered."),(0,r.kt)("p",null,"Once \u2013 will be triggered only one time when the event is triggered."),(0,r.kt)("p",null,"It can be used to process the data passed within triggered event."),(0,r.kt)("h4",{id:"off-offonce"},"off, offOnce"),(0,r.kt)("p",null,"Remove on, once listeners with off and offOnce."),(0,r.kt)("h4",{id:"trigger"},"trigger"),(0,r.kt)("p",null,"Triggers any event, first argument is event name. Pass the data after the first argument to get it inside listeners callback."),(0,r.kt)("p",null,"Example for on, off, trigger events:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { getStorage } from 'vc-cake'\nconst exampleStorage = getStorage('example')\n\nconst eventCallback = (elementData) => {\n  console.log(elementData) // { tag: 'basicButton', id: 'asd1231f' } -> data comes from the place where event was triggered\n}\nexampleStorage.on('elementAdd', eventCallback)\nexampleStorage.trigger('elementAdd', { tag: 'basicButton', id: 'asd1231f' })\nexampleStorage.off('elementAdd', eventCallback)\n")),(0,r.kt)("h4",{id:"registeraction"},"registerAction"),(0,r.kt)("p",null,"Register an action with the first argument of action name and second \u2013 callback. In this callback it is possible to process the data from storage and return it to the place where action was called."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { getStorage } from 'vc-cake'\nconst exampleStorage = getStorage('example')\n\nconst elements = [\n  {tag: 'basicButton', id: 'e13aad2'},\n  {tag: 'shadowButton', id: 'f51aer1'},\n  {tag: '3dButton', id: 'g54bcc3'}\n]\n\nexampleStorage.registerAction('getElementById', (id) => {\n  return elements.find(item => item.id === id)\n})\n")),(0,r.kt)("h4",{id:"action"},"action"),(0,r.kt)("p",null,"Trigger registered action with the first argument of registered action name. Next argument be anything, it will be passed inside registerAction callback."),(0,r.kt)("p",null,"The difference between trigger some action is that it can return the data. This is the point where storage start to work similar as a service."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { getStorage } from 'vc-cake'\nconst exampleStorage = getStorage('example')\nconst currentElement = exampleStorage.action('getElementById', 'f51aer1')\nconsole.log(currentElement) // {tag: 'shadowButton', id: 'f51aer1'}\n")),(0,r.kt)("h4",{id:"state"},"state"),(0,r.kt)("p",null,"In the state you can set, get the data and listen for changes from any place."),(0,r.kt)("p",null,"For \u2018state\u2019 action there are multiple actions \u2013 set, get, onChange, ignoreChange."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { getStorage } from 'vc-cake'\n\nconst exampleStorage = getStorage('example')\nconst exampleElement = { tag: 'basicButton', id: 'asd123f1' }\n\nexampleStorage.state('element').set(exampleElement)\nconst exampleElementFromStorageState = exampleStorage.state('element').get()\nconsole.log(exampleElementFromStorageState) // { tag: 'basicButton', id: 'asd123f1' }\n\n// Listen for a state change\nconst stateChangeCallback = (currentState) => {\nconsole.log(currentState) // current state will be logged here\n}\n\nexampleStorage.state('element').onChange(stateChangeCallback) // listening for state change\nexampleStorage.state('element').ignoreChange(stateChangeCallback) // removing listener for state change\n")),(0,r.kt)("h3",{id:"real-life-example"},"Real life example"),(0,r.kt)("p",null,"Example of usage of elements and workspace storages:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * components/panels/addElement/lib/categories.js\n */\nimport {getService, getStorage} from 'vc-cake'\n\nconst cook = getService('cook')\nconst workspaceStorage = getStorage('workspace')\nconst elementsStorage = getStorage('elements')\n// ...\nconst workspace = workspaceStorage.state('settings').get() || false\nconst parentElementId = workspace && workspace.element ? workspace.element.id : false\nconst data = cook.get({ tag: tag, parent: parentElementId })\nelementsStorage.trigger('add', data.toJS(), true)\n\n/**\n * editor/stores/elements/elementsStorage.js\n */\nimport { addStorage, getService} from 'vc-cake'\n\nconst cook = getService('cook')\n\naddStorage('elements', (storage) => {\n  storage.on('add', (elementData, wrap = true, options = {}) => {\n    const createdElements = []\n    const cookElement = cook.get(elementData)\n    if (!cookElement) {\n      return\n    }\n    // ... here comes other code\n  })\n})\n")),(0,r.kt)("h2",{id:"stores-list"},"Stores list"),(0,r.kt)("p",null,"The services are located inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"public/editor/stores")," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/VisualComposer/builder/tree/master/public/editor/stores"},"folder"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"assets")," - works with CSS/JS and other assets related things for elements"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"attributes")," - inner API for elements attributes. Example: ",(0,r.kt)("inlineCode",{parentName:"li"},"iconpicker")," icons management."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"elements")," - add, update, delete, clone or move elements. That where all activity with layout data happens."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"elementsLoader")," - manages the process of enqueueing elements javascript bundle files for post-update action."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"events")," - custom events storage"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"history")," - undo/redo actions are managed in this storage"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hub")," - manage addons, elements, templates in HUB. Example: downloading new element from HUB"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"notifications")," - manage notifications messages for the editor"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sharedAssets")," - add new shared assets. Shared assets are predefined assets that elements can use inside their components. Example: ",(0,r.kt)("inlineCode",{parentName:"li"},"waypoints.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"shortcodesAssets")," - deals with assets that were returned by the server after rendering shortcode string in an element"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"wordpressData")," - is used to load initial data and save it after applying changes"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cacheStorage.js")," - small cache server for caching custom data"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"fieldOptionsStorage.js")," - attributes API storage to customize an initial value of an element attribute"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"layout.js")," - storage is used to manage pages layouts. Header, footer and sidebar settings"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"migrationStorage.js")," - manage the migration process"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"settingsStorage.js")," - manage settings for the current page. Settings like: layout, custom CSS/js, title and etc. Mostly works with data from the Settings panel"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"workspaceStorage.js")," - editor's workspace responsible for connecting navbar events with other storages and services")))}m.isMDXComponent=!0}}]);